<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Enroll New Patient | Care Circles</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css"/>
  	<link rel="stylesheet" href="assets/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/enroll.css">

    <!-- Favicon -->
    <link rel="icon" href="/favicon.png?v=4">
    <meta name="theme-color" content="#ffffff">
  </head>
  <body>
    <header>
      <!-- Navigation -->
      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#mobilemenu">
              <span class="sr-only">Toggle navigation</span>
            </button>
            <a class="navbar-brand" href="/"><img alt="logo" src="assets/img/logo2-navbar.png"></a>
          </div>
          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
              <li><a href="circles">My Circles</a></li>
              <li><a href="permissions">Permissions</a></li>
              <li><a href="">Help</a></li>
            </ul>
          </div>
          <div id="mobilemenu">
            <ul class="nav navbar-nav">
              <li><a href="circles">My Circles</a></li>
              <li><a href="permissions">Permissions</a></li>
              <li><a href="">Help</a></li>
            </ul>
          </div>
        </div>
      </nav>
    </header>
    <div class="container mt100">
      <h1 class="text-center">Patient Enrollment Form</h1>
      <!-- <div class="instructions">
        Instructions
      </div> -->
      <h3>1. Find Patient by Medical Care Plan Number (MCP, or Provincial Health Number)</h3>
      <form action="/patients" method="GET">
        <div class="form-group enrollsearchdiv">
          <label for="phn">Patient Provincial Health Number</label>
          <div class="row">
            <div class="col-xs-6">
              <input type="text" class="form-control enrollsearch" id="phn" name="phn" placeholder="Example: 9000123456">
            </div>
            <div class="col-xs-6">
              <button type="search" class="site-btn fullwidth enrollsearch" id="searchbutton">Search</button>
            </div>
          </div>
        </div>
      </form>
      <div class="confirmPatient">
      </div>
        <!-- <div class="form-group">
          <label for="full_name">Full Name</label>
          <input type="text" class="form-control" id="full_name" placeholder="First and Last Name">
        </div>
        <div class="form-group">
          <label for="dob">Date of Birth</label>
          <input type="date" class="form-control" id="dob" placeholder="YYYY-MM-DD">
        </div>
        <div class="form-group">
          <legend>Sex</legend>
          <div class="row sexOptions">
            <div class="col-xs-4 sexOptionsElement">
              <label for="sexChoice1" class="radio-inline">
                <input type="radio" name="sex" value="Male" id="sexChoice1">
                Male
              </label>
            </div>
            <div class="col-xs-4 sexOptionsElement">
              <label for="sexChoice2" class="radio-inline">
                <input type="radio" name="sex" value="Female" id="sexChoice2">
                Female
              </label>
            </div>
            <div class="col-xs-4 sexOptionsElement">
              <label for="sexChoice3" class="radio-inline">
                <input type="radio" name="sex" value="Nonbinary" id="sexChoice3">
                Non-binary
              </label>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="address">Mailing Address</label>
          <input type="text" class="form-control" id="address" placeholder="Mailing Address">
        </div> -->
        <div>
          <hr />
          <h3>2. Add patient's photo and contact information</h3>
        </div>
      <form action="/patients/new" method="POST">
        <div class="form-group">
          <label for="profile_photo">Profile Photo</label>
          <!-- <input type="file" id="profile_photo" style="display:none"/> -->
          <div id="profile_photo_row">
            <div id="OpenImgUpload" class="text-center">
              <a href="" id="uploadtext">
                <strong>Upload photo from computer</strong>
              </a>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="phone">Phone</label>
          <input type="tel" class="form-control" id="phone" placeholder="Phone">
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" class="form-control" id="email" placeholder="Email">
        </div>
        <div>
          <hr />
          <h3>3. Review terms and conditions with patient and confirm consent</h3>
        </div>
        <div>
          <div class="terms">
            <p>This Agreement may also choose to distribute the Original Code, and which, at the time the Contribution and the location of court. New Versions. Once Covered Code with only those rights set forth in this Agreement. Except as expressly stated herein. No patent license is intended to make such provision shall be deemed to constitute any admission of liability. MULTIPLE-LICENSED CODE. Initial Developer and Contributors to distribute such responsibility on an unmodified basis, with other code) and distribute copies of Original Code, and keep intact all notices in the aggregation are permitted. The terms of this License and the intellectual property infringement. In order to ensure that your Work remains useful to permit linking proprietary applications with the exception of content that is not providing you any injury or damages. If you are not compelled to copy and distribute the Larger Work as distributed under a different license.</p>
            <p>You do not apply to any part thereof, to be updated versions of this License Agreement), provided that You changed the files; and You must include a Compiled Work that they are willing to receive error reports for the specific language governing rights and licenses granted by such Contributor itself or anyone acting on such Contributor's behalf. Contributions do not accept this license. These authors are addressed as "you".</p>
            <p>Activities other than Lic ensor has the status `maintained' to `unmaintained' if there is no warranty for this service if you received it. Distribution of Executable Versions. In addition, each Contributor hereby grants Recipient a non-exclusive, worldwide, royalty-free copyright license to reproduce, analyze, test, perform and/or display publicly, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute the Program, the distribution and/or use of the authors if different.</p>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-6">
            <a href="/disagree" class="site-btn2 fullwidth">Disagree</a>
          </div>
          <div class="col-xs-6">
            <a href="#" id="agreebutton" class="site-btn fullwidth">Agree</a><br />
          </div>
        </div>
      </form>
    </div>
    <div>
      <div class="bottom-padding" style="height:60px">&nbsp;</div>
    </div>
    <footer>


      <script src="assets/js/jquery-2.1.4.min.js"></script>
    	<script src="assets/js/bootstrap.min.js"></script>
      <script src="assets/js/ripple.js"></script>
      <script src="assets/js/jquery.cookie.js"></script>
      <script>
        var patient = {};
        $(document).ready(function() {

          $("#searchbutton").click(function(e) {
            e.preventDefault();
            var grabPatient = $('#phn').val();
            $.ajax({
              type: "GET",
              url: `patients?phn=${grabPatient}`,
              data: {
                id: grabPatient,
                // access_token: $("#access_token").val()
              },
              success: function(response) {
                patient = response;
                console.log(response);
                const patientObject = response;
                // document.querySelector('#full_name').value = patientObject.name;
                // document.querySelector('#address').value = patientObject.address;
                // document.querySelector('#dob').value = patientObject.dob;
                $('#phone').val(patientObject.phoneNumber);
                // if (patientObject.sex == 'Male'){
                //   document.querySelector('#sexChoice1').checked = true;
                // } else if (patientObject.sex == 'Female') {
                //   document.querySelector('#sexChoice2').checked = true;
                // } else if (patientObject.sex == 'Nonbinary') {
                //   document.querySelector('#sexChoice3').checked = true;
                // }
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                const patientDOB  = new Date(patientObject.dob);
                document.querySelector('.confirmPatient').innerHTML = `
                  Are these details correct? If not, <a href="#"><strong>report an error</strong></a>.
                  <div class="confirmPatientDetails">
                    <p>
                      <h5>Full Name</h5>
                      ${patientObject.name}
                    </p>
                    <p>
                      <h5>Date of Birth</h5>
                      ${patientDOB.toLocaleDateString("en-US", options)}
                    </p>
                    <p>
                      <h5>Sex</h5>
                      ${patientObject.sex}
                    </p>
                    <p>
                      <h5>Mailing Address</h5>
                      ${patientObject.address}
                    </p>
                  </div>
                `
              },
              error: function(response) {
                alert('Error: Patient not found');
              }
            });
          });

          $(document).ready(function() {
            $("#agreebutton").click(function(e) {
              e.preventDefault();
              console.log()
              patient.phone = $('#phone').val();
              patient.email = $('#email').val();
              const grabPatient = document.querySelector('#phn').value;
              $.ajax({
                type: "POST",
                url: `patients`,
                data: patient,
                success: function(response) {
                  $.cookie("patientContext", JSON.stringify(response), { expires: 7, path: '/' });
                  console.log(response);
                  var patient = JSON.parse($.cookie("patientContext"));
                  if (patient == null) {
                    console.log("test null");
                  } else {
                    console.log(JSON.stringify(patient));
                    console.log(patient.phn);
                    console.log(patient.email);
                  }
                  window.location.href = "circles";
                },
                error: function(response) {
                  alert('error');
                }
              });
            });
            $("#uploadtext").click(function(e) {
              e.preventDefault();
            })
            let uploadClick = false;
            $("#OpenImgUpload").click(function(e) {
              // $("#profile_photo").trigger('click');
              setTimeout( () => {$("#OpenImgUpload").css("background-image", "url(/assets/img/edna.png)")}, 500);
              $("#uploadtext").css("visibility", "hidden");
              if (!uploadClick) {
                setTimeout( () => {$("#profile_photo_row").append(`<div style="color: green;">Great pic!</div>`)}, 1000);
                uploadClick = true;
              }
            });
          });

        });
      </script>
    </footer>
  </body>
</html>
