<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Enroll New Patient | Care Circles</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css"/>
  	<link rel="stylesheet" href="assets/css/font-awesome.min.css"/>
  	<link rel="stylesheet" href="assets/css/flaticon.css"/>
  	<link rel="stylesheet" href="assets/css/magnific-popup.css"/>
  	<link rel="stylesheet" href="assets/css/owl.carousel.css"/>
  </head>
  <body>
    <div class="container">
      <h2>Enroll New Patient</h2>
      <h3>1. Find Patient by Medical Care Plan Number (MCP, or Provincial Health Number)</h3>
      <form action="/patients" method="GET">
        <div class="form-group">
          <!-- <label for="phn">Find Patient by Provincial Health Number in Provincial Registry</label> -->
          <div class="row">
            <div class="col-6 col-md-10">
              <input type="text" class="form-control" id="phn" name="phn" placeholder="Patient's Provincial Health Number">
            </div>
            <div class="col-6 col-md-2">
              <button type="search" class="btn btn-primary form-control" id="searchbutton">Search</button>
            </div>
          </div>
        </div>
      </form>
      <form action="/patients/new" method="POST">
        <div class="form-group">
          <label for="full_name">Full Name</label>
          <input type="name" class="form-control" id="full_name" placeholder="First and Last Name">
        </div>
        <div class="form-group">
          <label for="dob">Date of Birth</label>
          <input type="date" class="form-control" id="dob" placeholder="DOB">
        </div>
        <div class="form-group">
          <label for="gender">Gender</label>
          <!-- <select class="custom-select"> -->
          <select class="form-control" id="gender">
            <option selected>Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
          </select>
        </div>
        <div class="form-group">
          <label for="address">Mailing Address</label>
          <input type="text" class="form-control" id="address" placeholder="Mailing Address">
        </div>
        <div>
          <h3>2. Contact Info</h3>
        </div>
        <div class="form-group">
          <label for="phone">Phone</label>
          <input type="phone" class="form-control" id="phone" placeholder="Phone">
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" class="form-control" id="email" placeholder="Email">
        </div>
        <div>
          <h3>3. Agreement</h3>
        </div>
        <div>
          <a data-toggle="collapse" href="#collapseExample">Terms and Conditions</a>
          <div class="collapse" id="collapseExample">
            <div class="card card-body">
              <p>This Agreement may also choose to distribute the Original Code, and which, at the time the Contribution and the location of court. New Versions. Once Covered Code with only those rights set forth in this Agreement. Except as expressly stated herein. No patent license is intended to make such provision shall be deemed to constitute any admission of liability. MULTIPLE-LICENSED CODE. Initial Developer and Contributors to distribute such responsibility on an unmodified basis, with other code) and distribute copies of Original Code, and keep intact all notices in the aggregation are permitted. The terms of this License and the intellectual property infringement. In order to ensure that your Work remains useful to permit linking proprietary applications with the exception of content that is not providing you any injury or damages. If you are not compelled to copy and distribute the Larger Work as distributed under a different license.</p>
              <p>You do not apply to any part thereof, to be updated versions of this License Agreement), provided that You changed the files; and You must include a Compiled Work that they are willing to receive error reports for the specific language governing rights and licenses granted by such Contributor itself or anyone acting on such Contributor's behalf. Contributions do not accept this license. These authors are addressed as "you".</p>
              <p>Activities other than Lic ensor has the status `maintained' to `unmaintained' if there is no warranty for this service if you received it. Distribution of Executable Versions. In addition, each Contributor hereby grants Recipient a non-exclusive, worldwide, royalty-free copyright license to reproduce, analyze, test, perform and/or display publicly, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute the Program, the distribution and/or use of the authors if different.</p>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="gridCheck">
            <label class="form-check-label" for="gridCheck">
              I agree
            </label>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-6 col-md-2 col-md-offset-2">
            <a href="/disagree.html" class="btn btn-danger form-control">Disagree</a>
          </div>
          <div class="col-sm-6 col-md-2 col-md-offset-2">
            <button id="agreebutton" class="btn btn-primary form-control">Agree</button><br />
          </div>
        </div>
      </form>
    </div>
    <div>
      <div class="bottom-padding" style="height:60px">&nbsp;</div>
    </div>
    <footer>
      <script src="assets/js/jquery-2.1.4.min.js"></script>
    	<script src="assets/js/bootstrap.min.js"></script>
    	<script src="assets/js/magnific-popup.min.js"></script>
    	<script src="assets/js/owl.carousel.min.js"></script>
    	<script src="assets/js/circle-progress.min.js"></script>
    	<script src="assets/js/main.js"></script>
      <script>

      $(document).ready(function() {

        $("#searchbutton").click(function(e) {
          e.preventDefault();
          const grabPatient = document.querySelector('#phn').value;
          $.ajax({
            type: "GET",
            url: `patients?phn=${grabPatient}`,
            data: {
              id: grabPatient,
              // access_token: $("#access_token").val()
            },
            success: function(result) {
              console.log(result);
              const patientObject = result;
              document.querySelector('#full_name').value = patientObject.name;
              document.querySelector('#address').value = patientObject.address;
              document.querySelector('#gender').value = patientObject.gender;
              document.querySelector('#dob').value = patientObject.dob;
              document.querySelector('#phone').value = patientObject.phoneNumber;
              // alert('ok');
            },
            error: function(result) {
              alert('error');
            }
          });
        });

        $(document).ready(function() {
          $("#agreebutton").click(function(e) {
            e.preventDefault();
            console.log("test");
            const grabPatient = document.querySelector('#phn').value;
            $.ajax({
              type: "POST",
              url: `patients`,
              data: {
                phone: $('#phone').val(),
                email: $('#email').val()
              },
              success: function(result) {
                window.location.href = "permissions.html";
              },
              error: function(result) {
                alert('error');
              }
            });
          });
        });

      });
      </script>
    </footer>
  </body>
</html>
